driver.navigate.to "http://<%= params["domain"] %>"
puts driver.title

driver.find_element(:id, 'user').send_keys '<%= params['admin_user'] %>'
driver.find_element(:id, 'password').send_keys '<%= params['admin_password'] %>'
driver.find_element(:id, 'password').submit
puts driver.title

driver.find_element(:id, 'expandDisplayName').click
driver.navigate.to "http://<%= params["domain"] %>/index.php/settings/apps?installed"
apps = driver.find_elements(:class, 'app').select { |x| /LDAP/ =~ x.text }
raise "no LDAP app found" unless apps.size > 0
link = apps.first
puts "found link #{link.text}"
link.click

driver.find_element(:class, 'enable').click

driver.navigate.to "http://<%= params["domain"] %>/index.php/settings/admin"
puts "configuring..."
driver.find_element(:id, 'ldap_host').send_keys '<%= params['ldap_host'] %>'
driver.find_element(:id, 'ldap_base').send_keys '<%= ldap_base %>'
driver.find_element(:id, 'ldap_dn').send_keys '<%= bind_user %>'
driver.find_element(:id, 'ldap_port').click
driver.find_element(:id, 'ldap_port').send_keys '389'
driver.find_element(:id, 'ldap_agent_password').send_keys '<%= bind_password %>'

driver.find_element(:class, 'ldap_action_continue').click()
puts "done first step"

driver.find_element(:id, 'ldap_userlist_filter').click()
driver.find_element(:id, 'ldap_userlist_filter').send_keys '(ou=People)'

